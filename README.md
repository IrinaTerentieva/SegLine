# ğŸŒ¿ SegLine: Geospatial Segmentation Pipeline

**SegLine** is a component of a reproducible pipeline for geospatial analysis of recovery across linear disturbances, including seismic lines and oil and gas exploration corridors. This tool is specifically designed to segment the footprint of linear disturbances into plots and subplotsâ€”units used for attribute extraction and for building decision trees to assess recovery status.

The pipeline is implemented in **Python** and uses tools such as **GeoPandas**, **Shapely**, and **Hydra** for efficient geospatial processing and flexible configuration management. It supports **parallel execution** and **modular design**, making it adaptable to a variety of geographic datasets.

SegLine represents the **second step** in the broader workflow for assessing recovery on linear disturbances. The **first step** involves the [Forest Line Mapper (FLM)](https://github.com/appliedgrg/flm), a set of scripts used to delineate the linear footprint from coarse or inaccurate prior layers. These source layers vary by jurisdictionâ€”for instance, Alberta relies on the Human Footprint Inventory (AMBI), while British Columbia uses the SLU dataset.

SegLine requires fixed-width **footprint** and **centerline** layers, typically generated by FLM. Its output includes the footprint segmented into **plots** (typically 100 mÂ²) and **subplots** (typically 10 mÂ²), with consistent and unique IDs assigned to each geometry, plot, and subplot.

A subsequent module for **attribute extraction** (e.g., vegetation cover, seedling density, trail presence) is under development and will be released soon.

SegLine was developed by the [Applied Geospatial Research Group](https://www.appliedgrg.ca/) at the University of Calgary, led by Dr. Greg McDermid, in collaboration with [Falcon & Swift Geomatics Ltd](https://www.falconandswift.ca/), an environmental consulting company supporting the planning and monitoring of recovery initiatives across Western Canada.

---

## ğŸ“ Project Structure

SegLine/
â”œâ”€â”€ docs/                         # MkDocs documentation site
â”‚   â”œâ”€â”€ index.md                  # Homepage for documentation
â”‚   â””â”€â”€ examples/                 # Example figures for each pipeline step
â”‚       â”œâ”€â”€ 1_line_footprint.png
â”‚       â”œâ”€â”€ ...
â”‚
â”œâ”€â”€ src/                          # Source code
â”‚   â”œâ”€â”€ utils/                    # Step-by-step scripts for segmentation
â”‚   â”‚   â”œâ”€â”€ assign_id.py
â”‚   â”‚   â”œâ”€â”€ smooth_centerline.py
â”‚   â”‚   â”œâ”€â”€ split_to_plots.py
â”‚   â”‚   â”œâ”€â”€ split_to_sides.py
â”‚   â”‚   â””â”€â”€ split_to_subplots.py
â”‚   â”‚
â”‚   â””â”€â”€ config/                   # Hydra configuration files
â”‚       â”œâ”€â”€ config.yaml           # Default config (used by scripts individually)
â”‚       â””â”€â”€ workflow.yaml         # Master config for full pipeline
â”‚
â”œâ”€â”€ run_segmentation.py          # Pipeline runner (calls all step scripts)
â”œâ”€â”€ mkdocs.yml                   # MkDocs site configuration
â”œâ”€â”€ requirements.txt             # Python dependencies
â””â”€â”€ README.md                    # Project overview and usage (GitHub landing page)


## ğŸš€ Usage

Run the full pipeline using:

```bash
python run_segmentation.py
```

## âœ… Dependencies

Install required packages using:
```bash
pip install -r requirements.txt
```

## ğŸ§© Pipeline Steps

The full segmentation pipeline consists of the following five steps:

1. **Assign Unique IDs**  
   Assigns a consistent `UniqueID` to each footprint polygon and links it with the corresponding centerline by interpolating sample points along the centerline.

![Footprint + Centerline](docs/examples/1_line_footprint.png)

2. **Smooth Centerlines** *(Optional)*  
   Reduces sharp angles in the centerlines using buffer-based smoothing to improve the quality of later segmentation.

[Smoothed Centerline](docs/examples/2_smooth_centerline.png)

3. **Split to Plots**  
   Uses the centerline (original or smoothed) to split each polygon into two sides and segments the geometry into **plots** of a specified target area (e.g., 100 mÂ²).

![Segmenting to Plots](docs/examples/3_plots.png)

4. **Split to Sides**  
   Identifies side pairs in each plot (based on orientation and shared edge points), and assigns side labels and `segment_id`.

![Defining Sides and Plots](docs/examples/4_sides.png)

5. **Split to Subplots**  
   Each side is further split into equal-area **subplots** (e.g., 10 mÂ²), and each is assigned a `subplot_id` for fine-scale analysis.
![Segmenting to Subplots](docs/examples/5_subplots.png)

---
## âš™ï¸ Configuration (YAML)

The pipeline is controlled via Hydra configuration in workflow.yaml

dataset:
  ground_footprint: path/to/footprint.gpkg  # Output of FLM
  ground_footprint_layer: null              # Optional: specify if GPKG has nested layers
  centerline: path/to/centerline.gpkg       # Output of FLM
  centerline_layer: null                    # Optional
  debug: false
  unique_id_length: 8                       # Length of randomly generated UniqueID

smoothening:
  use_assign_id_output: true                # Use output from assign_id step
  centerline: null                          # Optional override
  angle_threshold: 120                      # Lower values trigger more smoothing
  buffer_distance: 2                        # Controls smoothing strength
  num_workers: 8

split_to_plots:
  segment_area: 100                         # Target area for plot segments (mÂ²)
  max_splitter_length_buffer: 30            # Prevents oversplitting on curves
  extension_distance: 50                    # How far to extend centerline before splitting
  use_smooth_centerline: true               # Whether to use smoothed version for splitting
  num_workers: 8

split_to_side:
  segment_area: 100                         # Must match plot area
  min_area: 5                               # Ignore small segments and merge with neighbors

split_to_subplots:
  segment_area: 10                          # Target area for each subplot (mÂ²)
  extension_distance: 50
  max_splitter_length_buffer: 15
  num_workers: 8

## ğŸ¤ Acknowledgments

Developed by:

    Applied Geospatial Research Group, University of Calgary
         https://www.appliedgrg.ca/

    Falcon & Swift Geomatics Ltd
      https://www.falconandswift.ca/