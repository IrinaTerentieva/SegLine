# üåø SegLine: Geospatial Pipeline for Segmentation of Linear Disturbances

**SegLine** is a component of a reproducible pipeline for geospatial analysis of recovery across linear disturbances, including seismic lines - oil and gas exploration corridors. This tool is specifically designed to segment the footprint of linear disturbances into plots and subplots‚Äîunits used for attribute extraction and for building decision trees to assess recovery status.

The pipeline is implemented in **Python** and uses tools such as **GeoPandas**, **Shapely**, and **Hydra** for efficient geospatial processing and flexible configuration management. It supports **parallel execution** and **modular design**, making it adaptable to a variety of geographic datasets.

SegLine represents the **second step** in the broader workflow for assessing recovery on linear disturbances. The **first step** involves the [Forest Line Mapper (FLM)](https://github.com/appliedgrg/flm), a set of scripts used to delineate the linear footprint from coarse or inaccurate prior layers. These source layers vary by jurisdiction‚Äîfor instance, Alberta relies on the Human Footprint Inventory (AMBI), while British Columbia uses the SLU dataset.

SegLine requires fixed-width **footprint** and **centerline** layers, typically generated by FLM. Its output includes the footprint segmented into **plots** (typically 100 m¬≤) and **subplots** (typically 10 m¬≤), with consistent and unique IDs assigned to each geometry, plot, and subplot.

A subsequent module for **attribute extraction** (e.g., vegetation cover, seedling density, trail presence) is under development and will be released soon.

SegLine was developed by the [Applied Geospatial Research Group](https://www.appliedgrg.ca/) at the University of Calgary, led by Dr. Greg McDermid, in collaboration with [Falcon & Swift Geomatics Ltd](https://www.falconandswift.ca/), an environmental consulting company supporting the planning and monitoring of recovery initiatives across Western Canada.

---

## üöÄ Usage

Run the full pipeline using:

```bash
python run_segmentation.py
```

## ‚úÖ Dependencies

Install required packages using:
```bash
pip install -r requirements.txt
```

## üß© Pipeline Steps

The full segmentation pipeline consists of the following five steps:

1. **Assign Unique IDs**  
   Assigns a consistent `UniqueID` to each footprint polygon and links it with the corresponding centerline by interpolating sample points along the centerline.

![Footprint + Centerline](docs/examples/1_line_footprint.png)

2. **Smooth Centerlines** *(Optional)*  
   Reduces sharp angles in the centerlines using buffer-based smoothing to improve the quality of later segmentation.

![Smoothed Centerline](docs/examples/2_smooth_centerline.png)

3. **Split to Plots**  
   Uses the centerline (original or smoothed) to split each polygon into two sides and segments the geometry into **plots** of a specified target area (e.g., 100 m¬≤).

![Segmenting to Plots](docs/examples/3_plots.png)

4. **Split to Sides**  
   Identifies side pairs in each plot (based on orientation and shared edge points), and assigns side labels and `segment_id`.

![Defining Sides and Plots](docs/examples/4_sides.png)

5. **Split to Subplots**  
   Each side is further split into equal-area **subplots** (e.g., 10 m¬≤), and each is assigned a `subplot_id` for fine-scale analysis.

![Segmenting to Subplots](docs/examples/5_subplots.png)

---
## ‚öôÔ∏è Configuration (YAML)

The pipeline is configured via workflow.yaml using Hydra. Below is a summary of the key parameters:

Dataset:

    ground_footprint: Path to footprint layer generated by FLM.
    ground_footprint_layer: Optional. Required if GPKG contains multiple layers.
    centerline: Path to centerline file from FLM.
    centerline_layer: Optional. Required if GPKG contains multiple layers.
    debug: Enable debugging mode (true/false).
    unique_id_length: Length of randomly generated UniqueID.

Smoothening:

    use_assign_id_output: Use output from assign ID step.
    centerline: Override centerline path if not using assign ID output.
    angle_threshold: Threshold for angle smoothing (lower = more aggressive).
    buffer_distance: Buffer size used for smoothing operations.
    num_workers: Number of parallel processes.

split_to_plots:

    segment_area: Target area for plot segments (e.g., 100 m¬≤).
    max_splitter_length_buffer: Max length of splitters to avoid oversplitting curves.
    extension_distance: Extend centerline ends before creating splitters.
    use_smooth_centerline: Use smoothed centerline for cleaner splits.
    num_workers: Parallel workers for splitting.

split_to_side:

    segment_area: Should match plot area.
    min_area: Minimum polygon area to retain. Smaller pieces are merged.

split_to_subplots:

    segment_area: Target subplot area (e.g., 10 m¬≤).
    extension_distance: Line extension before splitting.
    max_splitter_length_buffer: Splitter constraint for subplot division.
    num_workers: Parallel workers for subplot generation.

## ü§ù Acknowledgments

Developed by:

    Applied Geospatial Research Group, University of Calgary
         https://www.appliedgrg.ca/

    Falcon & Swift Geomatics Ltd
      https://www.falconandswift.ca/